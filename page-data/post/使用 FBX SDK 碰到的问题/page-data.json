{"componentChunkName":"component---src-components-post-jsx","path":"/post/使用 FBX SDK 碰到的问题","result":{"data":{"markdownRemark":{"id":"65184fdd-029d-581b-98cd-3a7aa4413326","frontmatter":{"date":"June 05, 2019","draft":null,"tags":null,"title":"使用 FBX SDK 碰到的问题"},"html":"<p>昨天由于要写一个关于 Direct3D 的东东，这个过程中就碰到关于模型的问题。\n虽然这次只用到一些简单的模型，但是我还是想通过加载模型文件的方式。然后的话，由于没有 maya， 3ds max 这样的专业软件，这时我又想起来了 windows 上的 3D 查看器。这个东西虽然不是那么专业，但是确实能够从里面的 3D 资源库 里找到一些可用的模型。</p>\n<p>这时出现第一个困扰我的问题，这个 3D 查看器 是可以把模型导出来没错，但是只有 GLTG 这种格式，本来听都没听说过， 一搜索找到了这个 <a href=\"https://github.com/Microsoft/DirectXMesh/wiki/Geometry-formats\">Geometry formats</a>\n发现关于 GLTF 确实有个 Microsoft.glTF.CPP 可以用。 然而这时候我想的是怎么把 GLTF 转成 X File,又找了半天，并没有找到答案。这时候我发现 windows 上的 画图 3D 可以打开 GLTF 文件， 并能够导出 [glb,fbx,3mf] 三种格式。一看 fbx 我认识啊，这就开始了这篇文章的主题 read-fbx-file。</p>\n<p>到自动桌的官网下了 fbx-sdk 装了，准备跑 sample。 又掉进坑里。</p>\n<p>在 VS Commond Prompt 运行</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">cmake -G <span class=\"token string\">\"NMake Makefiles\"</span> <span class=\"token punctuation\">..</span>\nnmake</code></pre></div>\n<p>会报错：</p>\n<blockquote>\n<p>无法生成 “C:\\Program Files\\Autodesk\\FBX\\FBXSDK\\2019.2\\lib\\\\x64\\libfbxsdk-md.lib”</p>\n</blockquote>\n<p>大概这么个意思。这时候不知道我怎么想的，以为是 VS 版本的问题，毕竟下 sdk 的时候是 <code class=\"language-text\">fbx20192_fbxsdk_vs2017_win.exe</code> 是吧？\n赶紧把这 2019 卸了（早就看这货不爽了），装 2017 版（一下，3 个小时过去了，（毕竟网速慢））。</p>\n<p>过去 22 小时又接着写。</p>\n<p>装了 2017 后才正式开始解决问题。因为报错和上面一样的。(我想简写了，复现这个过程的代价也太高了)</p>\n<ol>\n<li>\n<p>我找到上面所说的那个文件 它的真实路径应该是</p>\n<blockquote>\n<p>\"C:\\Program Files\\Autodesk\\FBX\\FBX SDK\\2019.2\\lib\\vs2017\\x64\\debug\\libfbxsdk-md.lib\"</p>\n</blockquote>\n<p>而 log 中是</p>\n<blockquote>\n<p>“C:\\Program Files\\Autodesk\\FBX\\FBXSDK\\2019.2\\lib\\\\x64\\\\libfbxsdk-md.lib”</p>\n</blockquote>\n<p>会发现缺少了 \"vs2017\" 和 “debug” 而它们的位置是由于空而留下这个 “\\\\”</p>\n</li>\n<li>\n<p>从 \"CMakeLists.txt\" 中发现它 <code class=\"language-text\">INCLUDE(&quot;../CMakeSettings.txt&quot;)</code> 进而跟踪到</p>\n<blockquote>\n<p>\"C:\\Program Files\\Autodesk\\FBX\\FBX SDK\\2019.2\\samples\\CMakeSettings.txt\"</p>\n</blockquote>\n<p>在这里，找到这么一段 CMake 代码</p>\n<div class=\"gatsby-highlight\" data-language=\"cmake\"><pre class=\"language-cmake\"><code class=\"language-cmake\"><span class=\"token function\">IF</span><span class=\"token punctuation\">(</span><span class=\"token variable\">MSVC_VERSION</span> <span class=\"token operator\">EQUAL</span> <span class=\"token number\">1700</span><span class=\"token punctuation\">)</span>\n   <span class=\"token function\">SET</span><span class=\"token punctuation\">(</span>FBX_COMPILER <span class=\"token string\">\"vs2012\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">ELSEIF</span><span class=\"token punctuation\">(</span><span class=\"token variable\">MSVC_VERSION</span> <span class=\"token operator\">EQUAL</span> <span class=\"token number\">1800</span><span class=\"token punctuation\">)</span>\n   <span class=\"token function\">SET</span><span class=\"token punctuation\">(</span>FBX_COMPILER <span class=\"token string\">\"vs2013\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">ELSEIF</span><span class=\"token punctuation\">(</span><span class=\"token variable\">MSVC_VERSION</span> <span class=\"token operator\">EQUAL</span> <span class=\"token number\">1900</span><span class=\"token punctuation\">)</span>\n   <span class=\"token function\">SET</span><span class=\"token punctuation\">(</span>FBX_COMPILER <span class=\"token string\">\"vs2015\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">ELSEIF</span><span class=\"token punctuation\">(</span><span class=\"token variable\">MSVC_VERSION</span> <span class=\"token operator\">EQUAL</span> <span class=\"token number\">1911</span><span class=\"token punctuation\">)</span>\n   <span class=\"token function\">SET</span><span class=\"token punctuation\">(</span>FBX_COMPILER <span class=\"token string\">\"vs2017\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">ENDIF</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>然后获取我的这个 VS 的 MSVC_VERSION， 是 1916 (好像是吧)\n还在 CMake 的文档里找到了这个</p>\n<blockquote>\n<p>MSVC_VERSION</p>\n<p>The version of Microsoft Visual C/C++ being used if any. If a compiler >simulating Visual C++ is being used, this variable is set to the toolset >version simulated as given by the _MSC_VER preprocessor definition.</p>\n<p>Known version numbers are:</p>\n<p>1200 = VS 6.0\n1300 = VS 7.0\n1310 = VS 7.1\n1400 = VS 8.0 (v80 toolset)\n1500 = VS 9.0 (v90 toolset)\n1600 = VS 10.0 (v100 toolset)\n1700 = VS 11.0 (v110 toolset)\n1800 = VS 12.0 (v120 toolset)\n1900 = VS 14.0 (v140 toolset)\n1910-1919 = VS 15.0 (v141 toolset)</p>\n</blockquote>\n<p>所以改成了这样</p>\n<div class=\"gatsby-highlight\" data-language=\"cmake\"><pre class=\"language-cmake\"><code class=\"language-cmake\"><span class=\"token function\">IF</span><span class=\"token punctuation\">(</span><span class=\"token variable\">MSVC_VERSION</span> <span class=\"token operator\">EQUAL</span> <span class=\"token number\">1700</span><span class=\"token punctuation\">)</span>\n   <span class=\"token function\">SET</span><span class=\"token punctuation\">(</span>FBX_COMPILER <span class=\"token string\">\"vs2012\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">ELSEIF</span><span class=\"token punctuation\">(</span><span class=\"token variable\">MSVC_VERSION</span> <span class=\"token operator\">EQUAL</span> <span class=\"token number\">1800</span><span class=\"token punctuation\">)</span>\n   <span class=\"token function\">SET</span><span class=\"token punctuation\">(</span>FBX_COMPILER <span class=\"token string\">\"vs2013\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">ELSEIF</span><span class=\"token punctuation\">(</span><span class=\"token variable\">MSVC_VERSION</span> <span class=\"token operator\">EQUAL</span> <span class=\"token number\">1900</span><span class=\"token punctuation\">)</span>\n   <span class=\"token function\">SET</span><span class=\"token punctuation\">(</span>FBX_COMPILER <span class=\"token string\">\"vs2015\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">ELSEIF</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token variable\">MSVC_VERSION</span> <span class=\"token operator\">GREATER</span> <span class=\"token number\">1909</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">AND</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">MSVC_VERSION</span> <span class=\"token operator\">LESS</span> <span class=\"token number\">1920</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n   <span class=\"token function\">SET</span><span class=\"token punctuation\">(</span>FBX_COMPILER <span class=\"token string\">\"vs2017\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">ENDIF</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>这样就解决了第一个 \"vs2017\" 没有被插入到路径的问题 然而还有第二个 “debug”， 其实它也可以是 “release”\n这个的话定位到了这</p>\n<div class=\"gatsby-highlight\" data-language=\"cmake\"><pre class=\"language-cmake\"><code class=\"language-cmake\"><span class=\"token function\">SET</span><span class=\"token punctuation\">(</span>FBX_VARIANT <span class=\"token string\">\"$(Configuration)\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>我把 Configuration 打印出来的话什么都没有。于是改成了这样</p>\n<div class=\"gatsby-highlight\" data-language=\"cmake\"><pre class=\"language-cmake\"><code class=\"language-cmake\"><span class=\"token function\">IF</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"<span class=\"token interpolation\"><span class=\"token punctuation\">${</span><span class=\"token variable\">Configuration</span><span class=\"token punctuation\">}</span></span>\"</span> <span class=\"token operator\">STREQUAL</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n   <span class=\"token function\">SET</span><span class=\"token punctuation\">(</span>FBX_VARIANT <span class=\"token string\">\"debug\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">ELSE</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n   <span class=\"token function\">SET</span><span class=\"token punctuation\">(</span>FBX_VARIANT <span class=\"token string\">\"$(Configuration)\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">ENDIF</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n</ol>\n<p>所以说，为什么 Autodesk 的一个 SDK bug 这么多。\n不过我直接卸 VS2019 的行为确实也没什么道理，要是发现了 log 的路径里多了两个 \"\\\" 的话，就能更快的解决问题了。</p>"}},"pageContext":{"id":"65184fdd-029d-581b-98cd-3a7aa4413326"}},"staticQueryHashes":[]}